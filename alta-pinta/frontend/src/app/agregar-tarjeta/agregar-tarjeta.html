<head>
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
</head>

<div class="container my-5">
  <div class="add-card mx-auto">

    <div class="add-card-header">
      <div class="card-icon">
        <i class="bi bi-credit-card-2-front-fill"></i>
      </div>
      <h4>Agregar tarjeta</h4>
      <p>Guarda tu tarjeta para compras más rápidas</p>
    </div>

    <form #formTarjeta="ngForm" (ngSubmit)="guardar(formTarjeta)" novalidate>

      <!-- NÚMERO DE TARJETA -->
      <div class="mb-3">
        <label class="form-label fw-semibold">
          <i class="bi bi-123 me-1 text-accent"></i>
          Número de tarjeta
        </label>

        <input class="form-control input-premium"
               placeholder="•••• •••• •••• ••••"
               [(ngModel)]="numero"
               name="numero"
               required
               pattern="^[0-9]{16}$"
               minlength="16"
               maxlength="16"
               inputmode="numeric"
               autocomplete="off"
               #numeroCtrl="ngModel">

        <div *ngIf="numeroCtrl.invalid && numeroCtrl.touched"
             class="text-danger small">
          Debe contener exactamente 16 dígitos numéricos
        </div>
      </div>

      <!-- TITULAR -->
      <div class="mb-3">
        <label class="form-label fw-semibold">
          <i class="bi bi-person-fill me-1 text-accent"></i>
          Titular
        </label>

        <input class="form-control input-premium"
               placeholder="Nombre del titular"
               [(ngModel)]="titular"
               name="titular"
               required>
      </div>

      <div class="row">

        <!-- FECHA -->
        <div class="col-md-6 mb-3">
          <label class="form-label fw-semibold">
            <i class="bi bi-calendar-event me-1 text-accent"></i>
            Vencimiento
          </label>

          <input class="form-control input-premium"
                 placeholder="MM/AAAA"
                 [(ngModel)]="fechaVencimiento"
                 name="fecha"
                 required
                 pattern="^(0[1-9]|1[0-2])\/[0-9]{4}$"
                 #fechaCtrl="ngModel">

          <div *ngIf="fechaCtrl.invalid && fechaCtrl.touched"
               class="text-danger small">
            Formato válido: MM/AAAA
          </div>

          <div *ngIf="!fechaCtrl.invalid && tarjetaVencida(fechaVencimiento)"
               class="text-danger small">
            La tarjeta ya está vencida
          </div>
        </div>

        <!-- CVV -->
        <div class="col-md-6 mb-3">
          <label class="form-label fw-semibold">
            <i class="bi bi-shield-lock-fill me-1 text-accent"></i>
            CVV
          </label>

          <input class="form-control input-premium"
                 type="password"
                 placeholder="***"
                 [(ngModel)]="cvv"
                 name="cvv"
                 required
                 pattern="^[0-9]{3}$"
                 minlength="3"
                 maxlength="3"
                 inputmode="numeric"
                 autocomplete="off"
                 #cvvCtrl="ngModel">

          <div *ngIf="cvvCtrl.invalid && cvvCtrl.touched"
               class="text-danger small">
            El CVV debe tener 3 dígitos
          </div>
        </div>
      </div>

      <!-- BOTÓN -->
      <button class="btn btn-guardar w-100 mt-3"
              type="submit"
              [disabled]="loading || formTarjeta.invalid">
        <i class="bi bi-check-circle-fill me-2"></i>
        {{ loading ? 'Guardando...' : 'Guardar tarjeta' }}
      </button>

      <!-- ERROR BACKEND -->
      <div *ngIf="error" class="alert alert-danger mt-3">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        {{ error }}
      </div>

    </form>

    <button class="btn btn-volver" type="button" (click)="volver()">
      <i class="bi bi-arrow-left"></i> Volver
    </button>

    <div class="add-card-footer">
      <i class="bi bi-lock-fill"></i>
      Tu información está protegida
    </div>

  </div>
</div>
