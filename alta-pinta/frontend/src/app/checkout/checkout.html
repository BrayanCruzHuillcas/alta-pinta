<header>
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
</header>

<div class="container my-5">
  <div class="checkout-card mx-auto">

    <div class="checkout-header">
      <div class="icon-circle">
        <i class="bi bi-credit-card-fill"></i>
      </div>
      <h3>Pago seguro</h3>
      <p>Estás a un paso de completar tu outfit</p>
    </div>

    <form (ngSubmit)="pagar()" #form="ngForm">

      <div class="mb-4">
        <label class="form-label fw-semibold">
          <i class="bi bi-wallet-fill me-1 text-accent"></i>
          Método de pago
        </label>

        <select class="form-select tarjeta-select"
                [(ngModel)]="tarjetaSeleccionada"
                name="tarjeta"
                required>

          <option [ngValue]="null">Selecciona una tarjeta</option>

          <option *ngFor="let t of tarjetas" [ngValue]="t">
            {{ t?.marca || 'TARJETA' }}
            •••• {{ t?.numero?.slice(-4) }}
            — S/ {{ t?.saldo | number:'1.2-2' }}
          </option>
        </select>
      </div>

      <button class="btn btn-pagar w-100" [disabled]="loading">
        <i class="bi bi-bag-check-fill me-2"></i>
        {{ loading ? 'Procesando...' : ('Pagar S/ ' + (total | number:'1.2-2')) }}
      </button>

      <div *ngIf="error" class="alert alert-danger mt-3">
        <i class="bi bi-x-circle-fill me-2"></i>
        {{ error }}
      </div>

      <div *ngIf="exito" class="alert alert-success mt-3">
        <i class="bi bi-check-circle-fill me-2"></i>
        ¡Pago realizado con éxito!
      </div>
    </form>

    <div class="nueva-tarjeta" (click)="AgregarTarjeta()">
      <i class="bi bi-plus-lg"></i>
      <span>Agregar nueva tarjeta</span>
    </div>

    <button class="btn btn-volver" type="button" (click)="volver()">
      <i class="bi bi-arrow-left"></i> Volver
    </button>

    <div class="checkout-footer">
      <i class="bi bi-shield-lock-fill"></i>
      Pago protegido · Datos encriptados
    </div>

    <strong *ngIf="pedidoResponse">
      Tiempo estimado de entrega: {{ pedidoResponse.tiempoEntrega }}
    </strong>

  </div>
</div>
